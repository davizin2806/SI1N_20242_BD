
CREATE SCHEMA EC1_SI1N;
USE EC1_SI1N;

CREATE TABLE IF NOT EXISTS FORNECEDORES(
FORNEC_COD INT PRIMARY KEY,
FORNEC_NOME VARCHAR(45) NOT NULL,
FORNEC_RUA VARCHAR(45) NOT NULL,
FORNEC_NUMRUA INT,
FORNEC_BAIRRO VARCHAR(45) NOT NULL,
FORNEC_CIDADE VARCHAR(45) NOT NULL,
FORNEC_ESTADO VARCHAR(45) NOT NULL,
FORNEC_PAIS VARCHAR(30) NOT NULL,
FORNEC_CODPOSTAL VARCHAR(10) NOT NULL,
FORNEC_TELEFONE VARCHAR(15) NOT NULL,
FORNEC_CONTATO VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FILIAIS(
FILIAL_COD INT PRIMARY KEY,
FILIAL_NOME VARCHAR(45) NOT NULL,
FILIAL_RUA VARCHAR(100) NOT NULL,
FILIAL_NUMRUA INT,
FILIAL_BAIRRO VARCHAR(50) NOT NULL,
FILIAL_CIDADE VARCHAR(50) NOT NULL,
FILIAL_ESTADO VARCHAR(50) NOT NULL,
FILIAL_PAIS VARCHAR(50) NOT NULL,
FILIAL_CODPOSTAL VARCHAR(10) NOT NULL,
FILIAL_CAPACIDADE TEXT NOT NULL);

CREATE TABLE IF NOT EXISTS PRODUTOS(
PROD_COD INT PRIMARY KEY,
PROD_NOME VARCHAR(50) NOT NULL,
PROD_DESCRICAO TEXT NOT NULL,
PROD_ESPECTEC TEXT NOT NULL,
PROD_QUANT DECIMAL(10,3) NOT NULL,
PROD_PRECOUNIT DECIMAL(10,2) NOT NULL,
PROD_UNIDMEDIDA VARCHAR(10) NOT NULL,
PROD_ESTOQ_MIN DECIMAL(10,3) NOT NULL
);

CREATE TABLE IF NOT EXISTS PEDIDOS(
PED_CODIGO INT PRIMARY KEY,
PED_DATA DATE NOT NULL,
PED_HORA TIME NOT NULL,
PED_PREVISAO DATE NOT NULL,
PED_STATUS ENUM('PENDENTE','CONCLUÍDO','EM ESPERA'),
PED_FORNECEDOR INT NOT NULL, #NOSSA CHAVE ESTRANGEIRA DE FORNECEDOR
#CRIANDO A REFERENCIA PARA A CHAVE ESTRANGEIRA
#RESTRIÇÃO APELIDO CH.ESTRANGEIRA(CAMPO CRIADO) REFERENCIA TABELA(CH.PRIMÁRIA)
CONSTRAINT FK_FORNECEDOR FOREIGN KEY (PED_FORNECEDOR) #DAR NOME A RESTRIÇÃO(CONSTRAINT) É UMA BOA PRÁTICA
REFERENCES FORNECEDORES(FORNEC_COD) #REFERENCIA A CHAVE PRIMÁRIA DE FORNECEDORES
);

CREATE TABLE IF NOT EXISTS RECEBIMENTOS(
RECEB_DATA DATE NOT NULL,
RECEB_HORA TIME NOT NULL,
RECEB_QUANT_PROD DECIMAL(10,3),
RECEB_CONDICAO TEXT NOT NULL,
RECEB_PEDIDOS INT PRIMARY KEY,
CONSTRAINT FK_PEDIDOS FOREIGN KEY(RECEB_PEDIDOS) REFERENCES PEDIDOS(PED_CODIGO));

CREATE TABLE IF NOT EXISTS PEDIDOS_PRODUTOS(
PDPR_PEDIDOS INT,
PDPR_PRODUTOS INT,
PRIMARY KEY(PDPR_PEDIDOS,PDPR_PRODUTOS),
PDPR_QUANT DECIMAL(10,3) NOT NULL,
CONSTRAINT PDPR_FK_PEDIDOS FOREIGN KEY(PDPR_PEDIDOS) REFERENCES PEDIDOS(PED_CODIGO),
CONSTRAINT PDPR_FK_PRODUTOS FOREIGN KEY(PDPR_PRODUTOS) REFERENCES PRODUTOS(PROD_COD)
);

CREATE TABLE IF NOT EXISTS FILIAIS_PRODUTOS(
FLPR_FILIAL INT,
FLPR_PRODUTOS INT,
PRIMARY KEY(FLPR_FILIAL,FLPR_PRODUTOS),
FLPR_QUANT DECIMAL(10,3) NOT NULL,
CONSTRAINT FLPR_FK_FILIAIS FOREIGN KEY(FLPR_FILIAL) REFERENCES FILIAIS(FILIAL_COD),
CONSTRAINT FLPR_FK_PRODUTOS FOREIGN KEY(FLPR_PRODUTOS) REFERENCES PRODUTOS(PROD_COD));

CREATE TABLE IF NOT EXISTS FORNECEDORES_PRODUTOS(
FRPR_FORNECEDOR INT,
FRPR_PRODUTOS INT,
PRIMARY KEY(FRPR_FORNECEDOR,FRPR_PRODUTOS),
CONSTRAINT FRPR_FK_FORNECEDORES FOREIGN KEY(FRPR_FORNECEDOR)
REFERENCES FORNECEDORES(FORNEC_COD),
CONSTRAINT FRPR_FK_PRODUTOS FOREIGN KEY(FRPR_PRODUTOS) 
REFERENCES PRODUTOS(PROD_COD));

DELETE FROM FORNECEDORES
WHERE FORNEC_COD = 5;

DELETE FROM FILIAIS
WHERE FILIAL_COD = 3;

DELETE FROM PRODUTOS
WHERE PROD_COD = 2;

DELETE FROM PEDIDOS
WHERE PED_CODIGO = 2;

DELETE FROM RECEBIMENTOS
WHERE RECEB_PEDIDOS = 1;

DELETE FROM PEDIDOS_PRODUTOS
WHERE PDPR_PEDIDOS = 1 AND PDPR_PRODUTOS = 2;

DELETE FROM FILIAIS_PRODUTOS
WHERE FLPR_FILIAL = 1 AND FLPR_PRODUTOS = 1;

DELETE FROM FORNECEDORES_PRODUTOS
WHERE FRPR_FORNECEDOR = 2 AND FRPR_PRODUTOS = 2;

UPDATE FORNECEDORES_PRODUTOS
SET FRPR_FORNECEDOR = 1
WHERE FRPR_FORNECEDOR = 2 AND FRPR_PRODUTOS = 2;

UPDATE FILIAIS_PRODUTOS
SET FLPR_QUANT = 120
WHERE FLPR_FILIAL = 2 AND FLPR_PRODUTOS = 2;

UPDATE PEDIDOS_PRODUTOS
SET PDPR_QUANT = 25
WHERE PDPR_PEDIDOS = 1 AND PDPR_PRODUTOS = 1;

UPDATE RECEBIMENTOS
SET RECEB_CONDICAO = 'Condição Atualizada', 
WHERE RECEB_PEDIDOS = 1;

UPDATE PEDIDOS
SET PED_STATUS = 'CONCLUÍDO', 
WHERE PED_CODIGO = 1;

UPDATE PRODUTOS
SET PROD_NOME = 'Produto Atualizado', 
WHERE PROD_COD = 1;

UPDATE FILIAIS
SET FILIAL_NOME = 'Filial Atualizada', 
WHERE FILIAL_COD = 2;

UPDATE FORNECEDORES
SET FORNEC_NOME = 'Fornecedor Atualizado', 
WHERE FORNEC_COD = 1;

INSERT INTO FORNECEDORES (FORNEC_COD, FORNEC_NOME, FORNEC_RUA, FORNEC_NUMRUA, FORNEC_BAIRRO, FORNEC_CIDADE, FORNEC_ESTADO, FORNEC_PAIS, FORNEC_CODPOSTAL, FORNEC_TELEFONE, FORNEC_CONTATO) 
VALUES 
(1, '1', 'Av. Central', 100, 'Centro', 'Cidade A', 'ESPIRITO SANTO', 'BRASIL', '12345-666', '33214413', 'FULANO'),
(2, '2', 'Rua 1', 50, 'Centro', 'Cidade B', 'ESPIRITO SANTO', 'BRASIL', '29000-000', '1111111', 'BELTRANO'),
(3, '3', 'Av. das Artes', 75, 'Bairro X', 'Cidade C', 'ESPIRITO SANTO', 'BRASIL', '33333-000', '2222222', 'CICLANO'),
(4, '3', 'Av. Brasil', 200, 'Bairro Y', 'Cidade D', 'ESPIRITO SANTO', 'BRASIL', '44444-000', '3333333', 'CONTRACICLANO'),
(5, '3', 'Rua 2', 10, 'Bairro Z', 'Cidade E', 'ESPIRITO SANTO', 'BRASIL', '55555-000', '44444444', 'TETRAFULANO');

INSERT INTO FILIAIS (FILIAL_COD, FILIAL_NOME, FILIAL_RUA, FILIAL_NUMRUA, FILIAL_BAIRRO, FILIAL_CIDADE, FILIAL_ESTADO, FILIAL_PAIS, FILIAL_CODPOSTAL, FILIAL_CAPACIDADE) 
VALUES 
(1, 'Filial 1', 'Rua A', 150, 'Centro', 'Cidade X', 'ESPIRITO SANTO', 'BRASIL', '12345-777', '1000'),
(2, 'Filial 2', 'Rua B', 200, 'Bairro Y', 'Cidade Y', 'ESPIRITO SANTO', 'BRASIL', '23456-888', '500'),
(3, 'Filial 3', 'Rua C', 50, 'Bairro Z', 'Cidade Z', 'ESPIRITO SANTO', 'BRASIL', '34567-999', '800');

INSERT INTO PRODUTOS (PROD_COD, PROD_NOME, PROD_DESCRICAO, PROD_ESPECTEC, PROD_QUANT, PROD_PRECOUNIT, PROD_UNIDMEDIDA, PROD_ESTOQ_MIN)
VALUES 
(1, 'Produto A', 'Descrição do Produto A', 'Especificação A', 100, 10.50, 'UN', 10),
(2, 'Produto B', 'Descrição do Produto B', 'Especificação B', 200, 25.75, 'UN', 5),
(3, 'Produto C', 'Descrição do Produto C', 'Especificação C', 300, 30.00, 'UN', 20);

INSERT INTO PEDIDOS (PED_CODIGO, PED_DATA, PED_HORA, PED_PREVISAO, PED_STATUS, PED_FORNECEDOR) 
VALUES 
(1, '2024-11-01', '10:00:00', '2024-11-10', 'PENDENTE', 1),
(2, '2024-11-02', '14:00:00', '2024-11-12', 'CONCLUÍDO', 2);

INSERT INTO RECEBIMENTOS (RECEB_DATA, RECEB_HORA, RECEB_QUANT_PROD, RECEB_CONDICAO, RECEB_PEDIDOS)
VALUES
('2024-11-03', '16:00:00', 50, 'Condição A', 1),
('2024-11-04', '09:00:00', 100, 'Condição B', 2);

INSERT INTO PEDIDOS_PRODUTOS (PDPR_PEDIDOS, PDPR_PRODUTOS, PDPR_QUANT)
VALUES 
(1, 1, 10),
(1, 2, 20),
(2, 3, 30);

INSERT INTO FILIAIS_PRODUTOS (FLPR_FILIAL, FLPR_PRODUTOS, FLPR_QUANT)
VALUES 
(1, 1, 50),
(2, 2, 100),
(3, 3, 200);

INSERT INTO FORNECEDORES_PRODUTOS (FRPR_FORNECEDOR, FRPR_PRODUTOS)
VALUES 
(1, 1),
(2, 2),
(3, 3);
